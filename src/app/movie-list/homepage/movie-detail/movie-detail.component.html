<ng-container *ngIf="movie">
  <div class="header-wrapper position-relative overflow-hidden p-5">
    <img class="header-bg" [src]="posterBg" alt='' />
    <div class="header-content row">
      <!-- poster start -->
      <div class="col-auto">
        <img [src]="poster1x" srcset="{{poster1x}} 1x, {{poster2x}} 2x" (error)="imgError($event)" />
      </div>
      <!-- info start -->
      <div class="col">
        <section>
          <div class="mb-4">
            <h2 class="text-white mb-0"><a [routerLink]="[]" class="text-white hover-white">{{movie.title}}</a> <span
                class="pl-2 release_date">({{movie.release_date|date:'yyyy'}})</span></h2>
            <div class="text-white facts">
              <span>{{movie.release_date|date:'shortDate'}}({{movie.production_countries[0]?.iso_3166_1}})</span>
              <span>
                <ng-container *ngFor="let genre of movie.genres;last as last ">
                  <a [routerLink]="[ROUTING_PATH.GENRE,genre.id]" class="text-white hover-white">{{genre.name}}</a>
                  <span class="pr-2" *ngIf="!last">,</span>
                </ng-container>
              </span>
              <span>{{runtime}}</span>
            </div>
          </div>
          <ul class="actions d-flex align-items-center mb-4">
            <li class="d-inline-flex align-items-center">
              <div class="user_score_chart">
                <app-rate-icon [rate]="movie.vote_average"></app-rate-icon>
              </div>
              <div class="font-weight-bold text-white ml-2">User<br />Score</div>
            </li>
            <li><button nz-button nz-popover [nzPopoverContent]="customListTemplate" nzPopoverPlacement="bottom"
                nzType="primary" nzSize="large" nzShape="circle" (click)="showAddCustomlistModal()">
                <i nz-icon nzType="unordered-list" nzTheme="outline"></i>
              </button>
            </li>
            <li>
              <button nz-button nzType="primary" nzSize="large" nzShape="circle" nz-popover
                [nzPopoverContent]="favoriteListTemplate" nzPopoverPlacement="bottom"
                (click)="handleAdd(ListType.FAVORITE)">
                <i nz-icon nzType="heart" [nzTheme]="isFavorite ? 'fill' : 'outline'"
                  [ngClass]="{ 'add-favorite': isFavorite }"></i>
              </button>
            </li>
            <li> <button nz-button nzType="primary" nzSize="large" nzShape="circle" nz-popover
                [nzPopoverContent]="watchListTemplate" nzPopoverPlacement="bottom"
                (click)="handleAdd(ListType.WATCHLIST)">
                <i nz-icon nzType="book" [nzTheme]="inWatchlist ? 'fill' : 'outline'"
                  [ngClass]="{ 'add-watchlist': inWatchlist }"></i>
              </button>
            </li>
          </ul>
          <p class="tagline">{{movie.tagline}}</p>
          <div class="header_info text-white">
            <h3 class="text-white">Overview</h3>
            <p>{{movie.overview}}</p>
            <ol class="crew flex-wrap mt-4">
              <li *ngFor="let crew of movie.credits.crew" class="col-4 m pr-4">
                <p><a class="font-weight-bolder text-white hover-white"
                    [routerLink]="['/',ROUTING_PATH.PERSON,crew.id]">
                    {{crew.name}}</a></p>
                <p>{{crew.job}}</p>
              </li>
            </ol>
          </div>
        </section>
      </div>
      <!-- info end -->
    </div>
  </div>
  <div>
  </div>
  <div class="container-xl d-flex flex-nowrap">
    <!-- cast start -->
    <div class="content_main">
      <section class="panel">
        <h3>Cast</h3>
        <div class="position-relative">
          <ol class="people scroller">
            <ng-container *ngFor="let cast of movie.credits.cast;index as i">
              <li class="card" *ngIf="i<7">
                <a [routerLink]="['/',ROUTING_PATH.PERSON,cast.id]">
                  <img loading="lazy" src="{{API_POSTER.GET_PERSON_1X+cast.profile_path}}"
                    srcset="{{API_POSTER.GET_PERSON_1X+cast.profile_path}} 1x, {{API_POSTER.GET_PERSON_2X+cast.profile_path}} 2x"
                    [alt]="cast.name">
                </a>
                <p><a class="font-weight-bolder text-black hover-black"
                    [routerLink]="['/',ROUTING_PATH.PERSON,cast.id]">{{cast.name}}</a></p>
                <p class="character">{{cast.character}}</p>
              </li>
            </ng-container>
          </ol>
          <div class="style_wrapper"></div>
        </div>
      </section>
      <ng-container *ngIf="recommendations$|async as recommendations">
        <section class="panel">
          <h3>Recommendations</h3>
          <div class="position-relative" *ngIf="recommendations.length>0;else emptyRecommendation">
            <ol class="recommendations scroller">
              <ng-container *ngFor="let remcommend of recommendations;index as i">
                <li>
                  <a [routerLink]="['/',ROUTING_PATH.MOVIE,remcommend.id]">
                    <img loading="lazy" src="{{API_POSTER.GET_RECOMMEND_1X+remcommend.backdrop_path}}"
                      srcset="{{API_POSTER.GET_RECOMMEND_1X+remcommend.backdrop_path}} 1x, {{API_POSTER.GET_RECOMMEND_2X+remcommend.backdrop_path}} 2x"
                      [alt]="remcommend.title">
                  </a>
                  <p class="d-flex justify-content-between"><a [routerLink]="['/',ROUTING_PATH.MOVIE,remcommend.id]"
                      class="font-weight-bolder text-black hover-black">{{remcommend.title}}</a><span>{{remcommend.vote_average}}%</span>
                  </p>
                </li>
              </ng-container>
            </ol>
            <div class="style_wrapper"></div>
          </div>
        </section>
        <ng-template #emptyRecommendation>We don't have recommendations for you.</ng-template>
      </ng-container>

    </div>
    <div class="content_side">
      <section>
        <p><strong>Status</strong>{{movie.status}}</p>
        <p><strong>Original Language</strong>{{movie.original_language|uppercase}}</p>
        <p><strong>Budge</strong>{{movie.budget|currency:'':'symbol':'0.0-0'}}</p>
        <p><strong>Revenue</strong>{{movie.revenue|currency :'':'symbol':'0.0-0'}}</p>
      </section>
    </div>
  </div>

  <div class="py-3 d-block d-md-none">
    <ng-container *ngTemplateOutlet="btns"></ng-container>
  </div>
</ng-container>

<ng-template #customListTemplate>
  <p> {{isLogin?'Add to list':'Login to create and edit custom lists'}}</p>
</ng-template>
<ng-template #favoriteListTemplate>
  <p> {{isLogin?'Mark as favorite':'Login to add this movie to your favorite list'}}</p>
</ng-template>
<ng-template #watchListTemplate>
  <p> {{isLogin?'Add to your watchlist':'Login to add this movie to your watch list'}}</p>
</ng-template>
